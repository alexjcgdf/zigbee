metadata {
    definition(name: "Tasmota TV IR Control", namespace: "jorgespneto", author: "Jorge Palmeira") {
        capability "TV"
	capability "Switch"
	
    	command "hdmi1"
   	command "hdmi2"
    	command "netflix"
   	command "up"
    	command "down"
    	command "right"
    	command "left"
    	command "confirm"
    	command "num1"
    	command "num2"
    	command "num3"
    	command "num4"
    	command "num5"
    	command "num6"
    	command "num7"
    	command "num8"
    	command "num9"
    	command "num0"

    }
}
preferences {
	input name: "TasmotaIP", title:"local IP address of Tasmota IR", type: "string", required: true
	input name: "username", title:"Username of Tasmota IR", type: "string"
	input name: "password", title:"Password of Tasmota IR", type: "string"
	input name: "OnIRsend", title:"On - Código IR", type: "string"
	input name: "OffIRsend", title:"Off - Código IR", type: "string"
 	input name: "ChanUpIRsend", title:"Channel Up - Código IR", type: "string"
 	input name: "ChanDownIRsend", title:"Channel Down - Código IR", type: "string"
 	input name: "VolUpIRsend", title:"Vol Up - Código IR", type: "string"
 	input name: "VolDownIRsend", title:"Vol Down - Código IR", type: "string"
	
	input name: "hdmi1IRsend", title:"Hdmi1 - Código IR", type: "string"
	input name: "hdmi2IRsend", title:"Hdmi2 - Código IR", type: "string"
	input name: "netflixIRsend", title:"netflix - Código IR", type: "string"
	input name: "upIRsend", title:"up - Código IR", type: "string"
	input name: "downIRsend", title:"down - Código IR", type: "string"
	input name: "rightIRsend", title:"right - Código IR", type: "string"
	input name: "leftIRsend", title:"left - Código IR", type: "string"
	input name: "confirmIRsend", title:"confirm - Código IR", type: "string"
	
	
	input name: "offThreshold", title:"Off Threshold Power (W)", type: "number", required: true, defaultValue: 3.9
	input name: "onThreshold", title:"On Threshold Power (W)", type: "number", required: true, defaultValue: 4
}

def parse(String description) {
    log.debug description
}


def installed() {
    initialize()
}

def updated() {
    initialize()
}

def initialize() {

}

def on() { 
    sendTasmota('IRsend '+ONIR)
    sendEvent(name: "switch", value: "on")
}

def off() {
    sendTasmota('IRsend '+OFFIR)
    sendEvent(name: "switch", value: "off")
}


def channelUp() {
    sendTasmota('IRsend '+CHUPIR)
    sendEvent(name: "channel", value: "channelUp")
}

def channelDown() {
    sendTasmota('IRsend '+CHDOIR)
    sendEvent(name: "channel", value: "channelDown")
}


def volumeUp() {
    sendTasmota('IRsend '+VOLUPIR)
    sendEvent(name: "volume", value: "volumeUp")
}

def volumeDown() {
    sendTasmota('IRsend '+VOLDOIR)
    sendEvent(name: "volume", value: "volumeDown")
}

//Comandos Extras


def netflix(){
	state.button = "Netflix"
}


def hdmi1() {
	log.debug "Selecting HDMI 1 as input"
}

def hdmi2() {
	log.debug "Selecting HDMI 2 as input"

}

def up(){
	state.button = "up"
}

def down(){
	state.button = "down"
}

def right(){
	state.button = "right"
}

def left(){
	state.button = "left"
}

def confirm(){
	state.button = "confirm"
}

def num1(){
	state.button = "num1"
}

def num2(){
	state.button = "num2"

}

def num3(){
	state.button = "num3"
}

def num4(){
	state.button = "num4"
}

def num5(){
	state.button = "num5"
}

def num6(){
	state.button = "num6"
}

def num7(){
	state.button = "num7"
}

def num8(){
	state.button = "num8"
}

def num9(){
	state.button = "num9"
}

def num0(){
	state.button = "num0"
}

//Fim dos comandos extras

def sendTasmota(command) {
	def options = [
		method: "GET",
		headers: [HOST: settings.TasmotaIP+":80"],
		path: "/cm?user=" + (settings.username ?: "") + "&password=" + (settings.password ?: "") + "&cmnd=" + URLEncoder.encode(command, "UTF-8").replaceAll(/\+/,'%20')
	]
	log.debug options
	def hubAction = new hubitat.device.HubAction(options, null) //Alterei
	sendHubCommand(hubAction)
}

def getONIR() {
	return (settings.OnIRsend ?: "")
}

def getOFFIR() {
	return (settings.OffIRsend ?: "")
}


def getCHUPIR() {
	return (settings.ChanUpIRsend ?: "")
}

def getCHDOIR() {
	return (settings.ChanDownIRsend ?: "")
}

def getVOLUPIR() {
	return (settings.VolUpIRsend ?: "")
}

def getVOLDOIR() {
	return (settings.VolDownIRsend ?: "")
}
